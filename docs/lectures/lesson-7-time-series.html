<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EDS 220 - Working with Environmental Datasets - 9&nbsp; Basic time series</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../lectures/lesson-8-vector-data.html" rel="next">
<link href="../discussion-sections/ds2-hares.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Basic time series</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">EDS 220 - Working with Environmental Datasets</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Welcome!</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-1-python-review.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Review</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">pandas</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-2-series-dataframes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><code>pd.Series</code> and <code>pd.DataFrames</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds1-anthr-prelim-data-exploration.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">* Lab: Preliminary data exploration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-3-pandas-subsetting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Subsetting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-4-basic-plotting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Plotting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-5-updating-dataframes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Updating data frames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-6-groupby.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><code>groupby()</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds2-hares.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">* Lab: Data cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-7-time-series.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Basic time series</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">geopandas</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-8-vector-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Vector data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-9-geopandas-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><code>geopandas</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-10-merge-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Merging data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-11-crs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Coordinate Reference Systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-12-csv-to-geo.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">csv to <code>GeoDataFrame</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/set-pat.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Setting a PAT</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#timestamps" id="toc-timestamps" class="nav-link active" data-scroll-target="#timestamps"><span class="toc-section-number">9.1</span>  Timestamps</a></li>
  <li><a href="#data-precipitation-in-boulder-co" id="toc-data-precipitation-in-boulder-co" class="nav-link" data-scroll-target="#data-precipitation-in-boulder-co"><span class="toc-section-number">9.2</span>  Data: Precipitation in Boulder, CO</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><span class="toc-section-number">9.3</span>  Data preparation</a></li>
  <li><a href="#indicate-missing-data" id="toc-indicate-missing-data" class="nav-link" data-scroll-target="#indicate-missing-data"><span class="toc-section-number">9.4</span>  Indicate missing data</a></li>
  <li><a href="#strings-into-dates" id="toc-strings-into-dates" class="nav-link" data-scroll-target="#strings-into-dates"><span class="toc-section-number">9.5</span>  Strings into dates</a></li>
  <li><a href="#timestamp-index" id="toc-timestamp-index" class="nav-link" data-scroll-target="#timestamp-index"><span class="toc-section-number">9.6</span>  Timestamp index</a></li>
  <li><a href="#subsetting-by-date" id="toc-subsetting-by-date" class="nav-link" data-scroll-target="#subsetting-by-date"><span class="toc-section-number">9.7</span>  Subsetting by date</a></li>
  <li><a href="#resample" id="toc-resample" class="nav-link" data-scroll-target="#resample"><span class="toc-section-number">9.8</span>  Resample</a></li>
  <li><a href="#more-info" id="toc-more-info" class="nav-link" data-scroll-target="#more-info"><span class="toc-section-number">9.9</span>  More info</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements"><span class="toc-section-number">9.10</span>  Acknowledgements</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Basic time series</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this section we will learn some basic handling of time series.</p>
<section id="timestamps" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="timestamps"><span class="header-section-number">9.1</span> Timestamps</h2>
<p><code>pandas</code> represents an instant in time using the <code>pandas.Timestamp</code> class. For example:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a timestamp</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pd.Timestamp(year<span class="op">=</span><span class="dv">2020</span>, month<span class="op">=</span><span class="dv">10</span>, day<span class="op">=</span><span class="dv">18</span>, hour<span class="op">=</span><span class="dv">12</span>, minute<span class="op">=</span><span class="dv">30</span>, second<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Timestamp('2020-10-18 12:30:15')</code></pre>
</div>
</div>
<p>When we store multiple Timestamps in a <code>pd.Series</code> (for example when we have a column of dates) the data type of the column is set to <code>datetime64[ns]</code>:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice the dtype of the column is datetime64</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>pd.Series([pd.Timestamp(<span class="dv">2020</span>,<span class="dv">10</span>,<span class="dv">18</span>), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>           pd.Timestamp(<span class="dv">2020</span>,<span class="dv">10</span>,<span class="dv">17</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>           pd.Timestamp(<span class="dv">2020</span>,<span class="dv">10</span>,<span class="dv">16</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>0   2020-10-18
1   2020-10-17
2   2020-10-16
dtype: datetime64[ns]</code></pre>
</div>
</div>
<p>This is enough to get us started!</p>
<!--
- NaT = not a time. `pd.NaT` = nd behaves similar as np.nan does for float data.
-->
</section>
<section id="data-precipitation-in-boulder-co" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="data-precipitation-in-boulder-co"><span class="header-section-number">9.2</span> Data: Precipitation in Boulder, CO</h2>
<p>To exemplify some of the basic time series functionalities we’ll be using data about hourly precipitation in the county of Boulder, Colorado from 2000 to 2014. In September 2013, an unusual weather pattern led to some of the most intense precipitation ever recorded in this region, causing devastating floods throughout the Colorado Front Range. Our goal is to visualize precipitation data in 2013 and identify this unusual weather event.</p>
<p>This data was obtained via the <a href="https://www.ncdc.noaa.gov/cdo-web/">National Oceanic and Atmosperic Administration (NOAA) Climate Data Online service</a>. This dataset is a csv and can be acceses at <a href="https://www.ncei.noaa.gov/orders/cdo/3488381.csv">this link</a>. You can <a href="https://www.ncei.noaa.gov/pub/data/cdo/documentation/PRECIP_HLY_documentation.pdf">view the full documentation here</a>. The following is a summary of the column descriptions:</p>
<ul>
<li><strong>STATION</strong>: identification number indentifying the station.</li>
<li><strong>STATION_NAME</strong>: optional field, name identifying the station location.</li>
<li><strong>DATE</strong>: this is the year of the record (4 digits), followed by month (2 digits), followed by day of the month (2 digits), followed by a space and ending with a time of observation that is a two digit indication of the local time hour, followed by a colon (:) followed by a two digit indication of the minute which for this dataset will always be 00. Note: The subsequent data value will be for the hour ending at the time specified here. Hour 00:00 will be listed as the first hour of each date, however since this data is by definition an accumulation of the previous 60 minutes, it actually occurred on the previous day.</li>
<li><strong>HPCP</strong>: The amount of precipitation recorded at the station for the hour ending at the time specified for DATE above given in inches. The values 999.99 means the data value is missing. Hours with no precipitation are not shown.</li>
</ul>
</section>
<section id="data-preparation" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="data-preparation"><span class="header-section-number">9.3</span> Data preparation</h2>
<p>Let’s start by reading in the data and taking a look at it.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/carmengg/eds-220-book/main/data/boulder_colorado_2013_hourly_precipitation.csv'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>precip <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># check df's head</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>precip.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>STATION</th>
      <th>STATION_NAME</th>
      <th>DATE</th>
      <th>HPCP</th>
      <th>Measurement Flag</th>
      <th>Quality Flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000101 00:00</td>
      <td>999.99</td>
      <td>]</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000101 01:00</td>
      <td>0.00</td>
      <td>g</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000102 20:00</td>
      <td>0.00</td>
      <td></td>
      <td>q</td>
    </tr>
    <tr>
      <th>3</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000103 01:00</td>
      <td>0.00</td>
      <td></td>
      <td>q</td>
    </tr>
    <tr>
      <th>4</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000103 05:00</td>
      <td>0.00</td>
      <td></td>
      <td>q</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s make a first attempt at plotting the precipitation:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>precip.HPCP.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-7-time-series_files/figure-html/cell-5-output-2.png" width="583" height="411"></p>
</div>
</div>
<p>There’s a few things going on with this graph:</p>
<ol type="1">
<li><p>There are many jumps close to 1000. This is clearly not right and these are outliers. Looking at the column description we can see 999.99 indicates the HPCP data is missing.</p></li>
<li><p>The x-axis values are given by the index of the dataframe and not relative to time.</p></li>
<li><p>We are only intersted in the precipitation data from 2013, this graph is trying to plot all our data.</p></li>
</ol>
<p>Let’s fix each one of these issues separately.</p>
</section>
<section id="indicate-missing-data" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="indicate-missing-data"><span class="header-section-number">9.4</span> Indicate missing data</h2>
<p>The metadata states the missing values are indicated by the number 999.99. We can use this information to reload the dataframe indicating 999.99 is the missing value. To do this, we add the <code>na_values</code> parameter to the <code>pd.read_csv()</code> function to indicitate additional values that should be recognized as <code>NA</code>:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in csv indicating NA values</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>precip <span class="op">=</span> pd.read_csv(url, na_values<span class="op">=</span>[<span class="fl">999.99</span>])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check updated df</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>precip.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>STATION</th>
      <th>STATION_NAME</th>
      <th>DATE</th>
      <th>HPCP</th>
      <th>Measurement Flag</th>
      <th>Quality Flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000101 00:00</td>
      <td>NaN</td>
      <td>]</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000101 01:00</td>
      <td>0.0</td>
      <td>g</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000102 20:00</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
    <tr>
      <th>3</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000103 01:00</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
    <tr>
      <th>4</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>20000103 05:00</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Default NA values
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check the <code>na_values</code> parameter in the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html"><code>pd.read_csv()</code> documentation</a> to learn more about which values are identified as <code>NA</code> by default.</p>
</div>
</div>
<p>We can try making our plot again:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>precip.HPCP.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-7-time-series_files/figure-html/cell-7-output-2.png" width="571" height="411"></p>
</div>
</div>
<p>This looks much better and we can already see there is something going on close to the end of the time series. We still need to set the index as the time.</p>
</section>
<section id="strings-into-dates" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="strings-into-dates"><span class="header-section-number">9.5</span> Strings into dates</h2>
<p>Notice that the DATE column in our dataframe is not of type <code>datetime</code>. We can check this using the <code>dtypes</code> attribute for dataframes:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the dtypes of all columns</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>precip.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>STATION              object
STATION_NAME         object
DATE                 object
HPCP                float64
Measurement Flag     object
Quality Flag         object
dtype: object</code></pre>
</div>
</div>
<!--
precip.DATE.apply(type).unique()
-->
<p>The <code>object</code> dtype means that (most likely) all values in that column are strings. We can convert strings to datetime objects using the <code>to_datetime()</code> pandas function:</p>
<ul>
<li><code>pd.to_datetime()</code> input: a <code>pd.Series</code> with strings that can be converted to dates</li>
<li><code>pd.to_datetime()</code> output: a <code>pd.Series</code> with the strings converted to <code>datetime</code> objects</li>
</ul>
<p><strong>Example</strong></p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># covert precip.DATE column to timedate objects</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pd.to_datetime(precip.DATE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>0      2000-01-01 00:00:00
1      2000-01-01 01:00:00
2      2000-01-02 20:00:00
3      2000-01-03 01:00:00
4      2000-01-03 05:00:00
               ...        
9001   2013-12-22 01:00:00
9002   2013-12-23 00:00:00
9003   2013-12-23 02:00:00
9004   2013-12-29 01:00:00
9005   2013-12-31 00:00:00
Name: DATE, Length: 9006, dtype: datetime64[ns]</code></pre>
</div>
</div>
<p>We can overwrite the DATE column with this output:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert DATE column from string to timestamps</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>precip.DATE <span class="op">=</span> pd.to_datetime(precip.DATE)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check column data type is updated</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(precip.dtypes)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check new values</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>precip.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>STATION                     object
STATION_NAME                object
DATE                datetime64[ns]
HPCP                       float64
Measurement Flag            object
Quality Flag                object
dtype: object</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>STATION</th>
      <th>STATION_NAME</th>
      <th>DATE</th>
      <th>HPCP</th>
      <th>Measurement Flag</th>
      <th>Quality Flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>2000-01-01 00:00:00</td>
      <td>NaN</td>
      <td>]</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>2000-01-01 01:00:00</td>
      <td>0.0</td>
      <td>g</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>2000-01-02 20:00:00</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
    <tr>
      <th>3</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>2000-01-03 01:00:00</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
    <tr>
      <th>4</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>2000-01-03 05:00:00</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>And we can make another try at plotting our precipitation data:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>precip.plot(x<span class="op">=</span><span class="st">'DATE'</span>, y<span class="op">=</span><span class="st">'HPCP'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;AxesSubplot:xlabel='DATE'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-7-time-series_files/figure-html/cell-11-output-2.png" width="571" height="401"></p>
</div>
</div>
<p>Notice the x-axis is now neatly organized into years.</p>
</section>
<section id="timestamp-index" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="timestamp-index"><span class="header-section-number">9.6</span> Timestamp index</h2>
<p>At its core, we have time series data if our data frame is indexed by moments in time. Using our DATE column as the index will allows us to do many operations with respect to time, including subsetting and resampling.</p>
<p>Updating the index of a dataframe is simple, we use the <code>set_index()</code> method. It’s general syntax is</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(new_index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>new_index</code> is:</p>
<ul>
<li>the name of the column (string) we want to set as index, or</li>
<li>if our new index is not a column in the dataframe, an array or <code>pd.Series</code> of the same length as our data frame (we need one index per row!).</li>
</ul>
<p>Notice that <code>set_index</code> does not modify the data frame in place.</p>
<p><strong>Example</strong></p>
<p>In our precipitation data this is:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set DATE coumn as index</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>precip <span class="op">=</span> precip.set_index(<span class="st">'DATE'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check new index</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>precip.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>STATION</th>
      <th>STATION_NAME</th>
      <th>HPCP</th>
      <th>Measurement Flag</th>
      <th>Quality Flag</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01 00:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>NaN</td>
      <td>]</td>
      <td></td>
    </tr>
    <tr>
      <th>2000-01-01 01:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>0.0</td>
      <td>g</td>
      <td></td>
    </tr>
    <tr>
      <th>2000-01-02 20:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
    <tr>
      <th>2000-01-03 01:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
    <tr>
      <th>2000-01-03 05:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>0.0</td>
      <td></td>
      <td>q</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Since we know the default behaviour of <code>plot()</code> is to use the index as the x-axis and make a line plot for each numeric column, we can simplify our plot making like this:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>precip.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;AxesSubplot:xlabel='DATE'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-7-time-series_files/figure-html/cell-13-output-2.png" width="571" height="401"></p>
</div>
</div>
<!--
:::{.callout-note}
More on pd.read_csv(). You can set the index and the date columns
df = pd.read_csv(file, index_col=['date'], parse_dates=['date'])

:::
-->
</section>
<section id="subsetting-by-date" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="subsetting-by-date"><span class="header-section-number">9.7</span> Subsetting by date</h2>
<p><code>pandas</code> has great functionality to subset a dataframe when using a time index. These are some examples:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select data from a given month and year</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># use loc['year-month']</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>precip.loc[<span class="st">'2013-09'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>STATION</th>
      <th>STATION_NAME</th>
      <th>HPCP</th>
      <th>Measurement Flag</th>
      <th>Quality Flag</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-09-01 00:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>NaN</td>
      <td>]</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-09-01 01:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>NaN</td>
      <td>[</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-09-01 00:00:00</th>
      <td>COOP:050183</td>
      <td>ALLENSPARK 2 SE CO US</td>
      <td>NaN</td>
      <td>]</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-09-01 01:00:00</th>
      <td>COOP:050183</td>
      <td>ALLENSPARK 2 SE CO US</td>
      <td>NaN</td>
      <td>[</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-09-01 00:00:00</th>
      <td>COOP:055121</td>
      <td>LONGMONT 6 NW CO US</td>
      <td>NaN</td>
      <td>}</td>
      <td></td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2013-09-23 02:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>0.2</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-09-27 10:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>0.1</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-09-27 15:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>0.1</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-09-27 17:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>0.1</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-09-27 18:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>0.1</td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
<p>128 rows × 5 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select data from a given year</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># use loc['year']</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>precip.loc[<span class="st">'2013'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>STATION</th>
      <th>STATION_NAME</th>
      <th>HPCP</th>
      <th>Measurement Flag</th>
      <th>Quality Flag</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01 01:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>0.0</td>
      <td>g</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-01-10 02:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>NaN</td>
      <td>[</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-01-13 00:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>NaN</td>
      <td>]</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-01-26 20:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>0.1</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-01-28 23:00:00</th>
      <td>COOP:055881</td>
      <td>NEDERLAND 5 NNW CO US</td>
      <td>0.1</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2013-12-22 01:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>NaN</td>
      <td>[</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-12-23 00:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>NaN</td>
      <td>]</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-12-23 02:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>0.1</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-12-29 01:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>NaN</td>
      <td>[</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-12-31 00:00:00</th>
      <td>COOP:050843</td>
      <td>BOULDER 2 CO US</td>
      <td>NaN</td>
      <td>]</td>
      <td></td>
    </tr>
  </tbody>
</table>
<p>662 rows × 5 columns</p>
</div>
</div>
</div>
<p>We can use this selection to plot data as usual. Notice we have a lot of gaps due to missing data.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>precip.loc[<span class="st">'2013'</span>].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>&lt;AxesSubplot:xlabel='DATE'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-7-time-series_files/figure-html/cell-16-output-2.png" width="571" height="412"></p>
</div>
</div>
</section>
<section id="resample" class="level2" data-number="9.8">
<h2 data-number="9.8" class="anchored" data-anchor-id="resample"><span class="header-section-number">9.8</span> Resample</h2>
<p>Resampling a time series means converting a time series from one frequency to another. For example, monthly to yearly (downsampling) or weekly to daily (upsampling). We can resample with the <code>resample()</code> method. The simplest use is to call</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df.resample(new_frequency).aggregator_function()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where: - <code>new_frequency</code> is a string representing the new frequence to resample the data, for example <code>'D'</code> for day, <code>w</code> for week, <code>M</code> for month, <code>Y</code> for year, and - <code>aggregator_function()</code> is the function we will use to aggregate the data into the new frequence. For example, <code>max()</code>, <code>min()</code>, <code>sum()</code> or <code>average()</code>.</p>
<p><code>resample()</code> works similarly to <code>groupby()</code> in the sense that you need to specify a way to aggregate the data to get any output.</p>
<p><strong>Example</strong></p>
<p>Our 2013 precipitation data has hourly frequency and we want to resample it to daily frequency.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># resample 2013 hourly data to daily frequency</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nothing happens</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>precip.loc[<span class="st">'2013'</span>].resample(<span class="st">'D'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>&lt;pandas.core.resample.DatetimeIndexResampler object at 0x7f2b11ceb510&gt;</code></pre>
</div>
</div>
<p>To get an output we need to add an aggregator function that indicates how we want to summarize the data that falls on each day. In this case we want the total precipitation on a day, so we will aggreagte using <code>sum()</code>:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total daily precipitation in 2013</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>daily_precip_2013 <span class="op">=</span> precip.loc[<span class="st">'2013'</span>].resample(<span class="st">'D'</span>).<span class="bu">sum</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>daily_precip_2013</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>HPCP</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2013-01-02</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2013-01-03</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2013-01-04</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2013-01-05</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2013-12-27</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2013-12-28</th>
      <td>0.1</td>
    </tr>
    <tr>
      <th>2013-12-29</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2013-12-30</th>
      <td>0.1</td>
    </tr>
    <tr>
      <th>2013-12-31</th>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>365 rows × 1 columns</p>
</div>
</div>
</div>
<p>Notice the index now is every day in 2013. We should rename that column since it is not longer hourly precipitation:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename column</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>daily_precip_2013 <span class="op">=</span> daily_precip_2013.rename(columns<span class="op">=</span>{<span class="st">'HPCP'</span>:<span class="st">'daily_precipitation'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we can plot our data:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>daily_precip_2013.plot(ylabel<span class="op">=</span><span class="st">'daily precipitation (in)'</span>, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                       xlabel<span class="op">=</span><span class="st">'date'</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                       title<span class="op">=</span><span class="st">'Precipitation in Boulder, CO during 2013'</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                       legend<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>&lt;AxesSubplot:title={'center':'Precipitation in Boulder, CO during 2013'}, xlabel='date', ylabel='daily precipitation (in)'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-7-time-series_files/figure-html/cell-20-output-2.png" width="576" height="464"></p>
</div>
</div>
</section>
<section id="more-info" class="level2" data-number="9.9">
<h2 data-number="9.9" class="anchored" data-anchor-id="more-info"><span class="header-section-number">9.9</span> More info</h2>
<p>As usual, there’s so much more to learn about time series data. These documents will allow you to dive deeper:</p>
<p>📖 <a href="https://pandas.pydata.org/docs/getting_started/intro_tutorials/09_timeseries.html#min-tut-09-timeseries"><code>pandas</code> getting started tutorials - How to handle time series data with ease</a></p>
<p>📖 <a href="https://wesmckinney.com/book/time-series">Time Series Chapter, Python for Data Analysis, Wes McKinney</a></p>
<p>📖 <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html"><code>pandas</code> User Guide - Time series/date functionality</a></p>
</section>
<section id="acknowledgements" class="level2" data-number="9.10">
<h2 data-number="9.10" class="anchored" data-anchor-id="acknowledgements"><span class="header-section-number">9.10</span> Acknowledgements</h2>
<p>This lesson was adapted from <a href="https://github.com/samanthastevenson/EDS220_Fall2022/blob/main/Precipitation_QCexample_BoulderCO.ipynb">Dr.&nbsp;Sam Stevenson’s lecture on Data quality control and outliers: 1D time series</a> and <a href="https://www.earthdatascience.org/courses/use-data-open-source-python/use-time-series-data-in-python/introduction-to-time-series-in-pandas-python/">Earth Lab’s Lesson 1. Work With Datetime Format in Python - Time Series Data</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../discussion-sections/ds2-hares.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">* Lab: Data cleaning</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../lectures/lesson-8-vector-data.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Vector data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>