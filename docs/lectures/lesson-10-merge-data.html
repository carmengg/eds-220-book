<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EDS 220 - Working with Environmental Datasets - 13&nbsp; Merging data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../lectures/lesson-12-csv-to-geo.html" rel="next">
<link href="../lectures/lesson-9-geopandas-intro.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../lectures/lesson-8-vector-data.html">Vector data</a></li><li class="breadcrumb-item"><a href="../lectures/lesson-10-merge-data.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merging data</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">EDS 220 - Working with Environmental Datasets</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-1-python-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Review</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tabular data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-2-series-dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><code>pandas</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds1-anthr-prelim-data-exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">* Lab: Preliminary data exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-3-pandas-subsetting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Subsetting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-4-basic-plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Plotting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-5-updating-dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Updating data frames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-6-groupby.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><code>groupby()</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds2-hares.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">* Lab: Data cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-7-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Basic time series</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Vector data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-8-vector-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data formats</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-11-crs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Coordinate Reference Systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-9-geopandas-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title"><code>geopandas</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-10-merge-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merging data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-12-csv-to-geo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">csv to <code>GeoDataFrame</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-13-reproject-and-clip.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Reprojecting &amp; Clipping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds3-earthquakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">*Lab: Maps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-21-contextily-parquet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Parquet and contextily</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Multi-dimensional data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-14-multidimensional-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">NetCDF</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-15-xarray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title"><code>xarray</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Raster data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-17-rioxarray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title"><code>rioxarray</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-19-dem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Raster manipulation I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds4-landcover.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">*Lab: land cover statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-18-STAC.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">STAC specification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds5-modis-ndvi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">*Lab: STAC access</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-22-make_a_gif.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Make a GIF</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/set-pat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Setting a PAT</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/gitignore_untrack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Gitignore &amp; Git Untracking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/undoing-commit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Undoing commits</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#types-of-joins" id="toc-types-of-joins" class="nav-link active" data-scroll-target="#types-of-joins"><span class="header-section-number">13.1</span> Types of Joins</a>
  <ul class="collapse">
  <li><a href="#inner-join" id="toc-inner-join" class="nav-link" data-scroll-target="#inner-join"><span class="header-section-number">13.1.1</span> Inner Join</a></li>
  <li><a href="#left-join" id="toc-left-join" class="nav-link" data-scroll-target="#left-join"><span class="header-section-number">13.1.2</span> Left Join</a></li>
  <li><a href="#right-join" id="toc-right-join" class="nav-link" data-scroll-target="#right-join"><span class="header-section-number">13.1.3</span> Right Join</a></li>
  <li><a href="#full-join" id="toc-full-join" class="nav-link" data-scroll-target="#full-join"><span class="header-section-number">13.1.4</span> Full Join</a></li>
  </ul></li>
  <li><a href="#goal" id="toc-goal" class="nav-link" data-scroll-target="#goal"><span class="header-section-number">13.2</span> Goal</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">13.3</span> Data</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><span class="header-section-number">13.4</span> Data preparation</a>
  <ul class="collapse">
  <li><a href="#countries" id="toc-countries" class="nav-link" data-scroll-target="#countries"><span class="header-section-number">13.4.1</span> Countries</a></li>
  <li><a href="#arctic-communities" id="toc-arctic-communities" class="nav-link" data-scroll-target="#arctic-communities"><span class="header-section-number">13.4.2</span> Arctic communities</a></li>
  </ul></li>
  <li><a href="#merge-datasets" id="toc-merge-datasets" class="nav-link" data-scroll-target="#merge-datasets"><span class="header-section-number">13.5</span> Merge datasets</a></li>
  <li><a href="#choropleth-map" id="toc-choropleth-map" class="nav-link" data-scroll-target="#choropleth-map"><span class="header-section-number">13.6</span> Choropleth map</a></li>
  <li><a href="#complete-workflow" id="toc-complete-workflow" class="nav-link" data-scroll-target="#complete-workflow"><span class="header-section-number">13.7</span> Complete workflow</a></li>
  <li><a href="#acknowledgments" id="toc-acknowledgments" class="nav-link" data-scroll-target="#acknowledgments"><span class="header-section-number">13.8</span> Acknowledgments</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">13.9</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merging data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- 
Fixing the preview working directory

::: {.cell execution_count=1}
``` {.python .cell-code}
import os
home = os.path.expanduser("~")
os.chdir(os.path.join(home,'eds-220-book'))
```
:::


Ignore ShapelyDeprecationWarning warning in render

::: {.cell execution_count=2}
``` {.python .cell-code}
import shapely
import warnings
from shapely.errors import ShapelyDeprecationWarning

warnings.filterwarnings("ignore", category=ShapelyDeprecationWarning) 
```
:::


-->
<p>In this section we will learn how to join dataframes and will apply this to creating a choropleth map with <code>geopandas</code>.</p>
<section id="types-of-joins" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="types-of-joins"><span class="header-section-number">13.1</span> Types of Joins</h2>
<p>Frequently, analysis of data will require merging separate dataframes. There are multiple ways to merge observations. When conceptualizing merges, we think of two tables, one on the <em>left</em> and one on the <em>right</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/merging_data/join-diagrams-separate.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Image source: Data Modeling Essentials, NCEAS Learning Hub</figcaption>
</figure>
</div>
<section id="inner-join" class="level3" data-number="13.1.1">
<h3 data-number="13.1.1" class="anchored" data-anchor-id="inner-join"><span class="header-section-number">13.1.1</span> Inner Join</h3>
<p>An <em>inner join</em> is when you merge the subset of rows that have matches in both the left table and the right table.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/merging_data/join-diagrams-inner.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Image source: Data Modeling Essentials, NCEAS Learning Hub</figcaption>
</figure>
</div>
</section>
<section id="left-join" class="level3" data-number="13.1.2">
<h3 data-number="13.1.2" class="anchored" data-anchor-id="left-join"><span class="header-section-number">13.1.2</span> Left Join</h3>
<p>A <em>left join</em> takes all of the rows from the left table, and merges on the data from matching rows in the right table. Keys that don’t match from the left table are still provided with a missing value (na) from the right table.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/merging_data/join-diagrams-left.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Image source: Data Modeling Essentials, NCEAS Learning Hub</figcaption>
</figure>
</div>
</section>
<section id="right-join" class="level3" data-number="13.1.3">
<h3 data-number="13.1.3" class="anchored" data-anchor-id="right-join"><span class="header-section-number">13.1.3</span> Right Join</h3>
<p>A <em>right join</em> is the same as a left join, except that all of the rows from the right table are included with matching data from the left, or a missing value. Notice that left and right joins can ultimately be the same depending on the positions of the tables.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/merging_data/join-diagrams-right.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Image source: Data Modeling Essentials, NCEAS Learning Hub</figcaption>
</figure>
</div>
</section>
<section id="full-join" class="level3" data-number="13.1.4">
<h3 data-number="13.1.4" class="anchored" data-anchor-id="full-join"><span class="header-section-number">13.1.4</span> Full Join</h3>
<p>Finally, a <em>full outer join</em> (or just <em>full join</em>) includes all data from all rows in both tables, and includes missing values wherever necessary.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/merging_data/join-diagrams-full.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Image source: Data Modeling Essentials, NCEAS Learning Hub</figcaption>
</figure>
</div>
<p>Sometimes people represent joins as Venn diagrams, showing which parts of the left and right tables are included in the results for each join. This representation is useful, however, they miss part of the story related to where the missing value comes from in each result.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/merging_data/join-venn.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Image source: R for Data Science, Wickham &amp; Grolemund.</figcaption>
</figure>
</div>
</section>
</section>
<section id="goal" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="goal"><span class="header-section-number">13.2</span> Goal</h2>
<p>Our goal in this lesson will be to join two datasets, one with demographic information and another with country outlines, to create the following choropleth map showing the number of Arctic communities by country and their location in <a href="https://en.wikipedia.org/wiki/Scandinavia">Scandinavia</a>:</p>
<p><img src="../images/arctic-comms.png" class="img-fluid"></p>
</section>
<section id="data" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="data"><span class="header-section-number">13.3</span> Data</h2>
<p>We will use two datasets in this lesson. The first dataset is <a href="https://www.naturalearthdata.com/downloads/50m-cultural-vectors/">Natural Earth’s medium scale cultural boundaries data (1:50m)</a>. We can obtain this dataset by downloading the shapefile. <a href="https://www.naturalearthdata.com">Natural Earth</a> is a public domain dataset with ready-to-use data for creating maps.</p>
<p>The second dataset we will use is a <a href="https://search.dataone.org/view/doi%3A10.18739%2FA28S4JQ80">list of Arctic communities and their location (Brook, 2023)</a> which can be accessed through the DataONE repository. This is a GeoJSON file with the following attributes:</p>
<ul>
<li><strong>name</strong>: name of Arctic community,</li>
<li><strong>population</strong>: population of Arctic community, as of 2022</li>
<li><strong>country</strong>: country that the Arctic community falls within (see dataset metadata for the codes)</li>
<li><strong>geoname-id</strong>: numeric codes that uniquely identify all administrative/legal and statistical geographic areas for which the Census Bureau tabulates data</li>
</ul>
</section>
<section id="data-preparation" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="data-preparation"><span class="header-section-number">13.4</span> Data preparation</h2>
<p>We start our analysis by importing the necessary libraries:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--
# will use this library to add a background to our map
import contextily as ctx
-->
<p>The Natural Earth dataset has many columns, so we need to update the <code>pandas</code> display settings to show all columns:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display all column when looking at dataframes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.max.columns"</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="countries" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1" class="anchored" data-anchor-id="countries"><span class="header-section-number">13.4.1</span> Countries</h3>
<p>Now we move on to preparing the polygons for the Scandinavian countries. To import the Natural Earth countries polygons we use the <code>geopandas.read_file()</code> function again:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import countries polygons</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> gpd.read_file(<span class="st">'data/ne_50m_admin_0_countries/ne_50m_admin_0_countries.shp'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>countries.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">featurecla</th>
<th data-quarto-table-cell-role="th">scalerank</th>
<th data-quarto-table-cell-role="th">LABELRANK</th>
<th data-quarto-table-cell-role="th">SOVEREIGNT</th>
<th data-quarto-table-cell-role="th">SOV_A3</th>
<th data-quarto-table-cell-role="th">ADM0_DIF</th>
<th data-quarto-table-cell-role="th">LEVEL</th>
<th data-quarto-table-cell-role="th">TYPE</th>
<th data-quarto-table-cell-role="th">TLC</th>
<th data-quarto-table-cell-role="th">ADMIN</th>
<th data-quarto-table-cell-role="th">ADM0_A3</th>
<th data-quarto-table-cell-role="th">GEOU_DIF</th>
<th data-quarto-table-cell-role="th">GEOUNIT</th>
<th data-quarto-table-cell-role="th">GU_A3</th>
<th data-quarto-table-cell-role="th">SU_DIF</th>
<th data-quarto-table-cell-role="th">SUBUNIT</th>
<th data-quarto-table-cell-role="th">SU_A3</th>
<th data-quarto-table-cell-role="th">BRK_DIFF</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">NAME_LONG</th>
<th data-quarto-table-cell-role="th">BRK_A3</th>
<th data-quarto-table-cell-role="th">BRK_NAME</th>
<th data-quarto-table-cell-role="th">BRK_GROUP</th>
<th data-quarto-table-cell-role="th">ABBREV</th>
<th data-quarto-table-cell-role="th">POSTAL</th>
<th data-quarto-table-cell-role="th">FORMAL_EN</th>
<th data-quarto-table-cell-role="th">FORMAL_FR</th>
<th data-quarto-table-cell-role="th">NAME_CIAWF</th>
<th data-quarto-table-cell-role="th">NOTE_ADM0</th>
<th data-quarto-table-cell-role="th">NOTE_BRK</th>
<th data-quarto-table-cell-role="th">NAME_SORT</th>
<th data-quarto-table-cell-role="th">NAME_ALT</th>
<th data-quarto-table-cell-role="th">MAPCOLOR7</th>
<th data-quarto-table-cell-role="th">MAPCOLOR8</th>
<th data-quarto-table-cell-role="th">MAPCOLOR9</th>
<th data-quarto-table-cell-role="th">MAPCOLOR13</th>
<th data-quarto-table-cell-role="th">POP_EST</th>
<th data-quarto-table-cell-role="th">POP_RANK</th>
<th data-quarto-table-cell-role="th">POP_YEAR</th>
<th data-quarto-table-cell-role="th">GDP_MD</th>
<th data-quarto-table-cell-role="th">GDP_YEAR</th>
<th data-quarto-table-cell-role="th">ECONOMY</th>
<th data-quarto-table-cell-role="th">INCOME_GRP</th>
<th data-quarto-table-cell-role="th">FIPS_10</th>
<th data-quarto-table-cell-role="th">ISO_A2</th>
<th data-quarto-table-cell-role="th">ISO_A2_EH</th>
<th data-quarto-table-cell-role="th">ISO_A3</th>
<th data-quarto-table-cell-role="th">ISO_A3_EH</th>
<th data-quarto-table-cell-role="th">ISO_N3</th>
<th data-quarto-table-cell-role="th">ISO_N3_EH</th>
<th data-quarto-table-cell-role="th">UN_A3</th>
<th data-quarto-table-cell-role="th">WB_A2</th>
<th data-quarto-table-cell-role="th">WB_A3</th>
<th data-quarto-table-cell-role="th">WOE_ID</th>
<th data-quarto-table-cell-role="th">WOE_ID_EH</th>
<th data-quarto-table-cell-role="th">WOE_NOTE</th>
<th data-quarto-table-cell-role="th">ADM0_ISO</th>
<th data-quarto-table-cell-role="th">ADM0_DIFF</th>
<th data-quarto-table-cell-role="th">ADM0_TLC</th>
<th data-quarto-table-cell-role="th">ADM0_A3_US</th>
<th data-quarto-table-cell-role="th">ADM0_A3_FR</th>
<th data-quarto-table-cell-role="th">ADM0_A3_RU</th>
<th data-quarto-table-cell-role="th">ADM0_A3_ES</th>
<th data-quarto-table-cell-role="th">ADM0_A3_CN</th>
<th data-quarto-table-cell-role="th">ADM0_A3_TW</th>
<th data-quarto-table-cell-role="th">ADM0_A3_IN</th>
<th data-quarto-table-cell-role="th">ADM0_A3_NP</th>
<th data-quarto-table-cell-role="th">ADM0_A3_PK</th>
<th data-quarto-table-cell-role="th">ADM0_A3_DE</th>
<th data-quarto-table-cell-role="th">ADM0_A3_GB</th>
<th data-quarto-table-cell-role="th">ADM0_A3_BR</th>
<th data-quarto-table-cell-role="th">ADM0_A3_IL</th>
<th data-quarto-table-cell-role="th">ADM0_A3_PS</th>
<th data-quarto-table-cell-role="th">ADM0_A3_SA</th>
<th data-quarto-table-cell-role="th">ADM0_A3_EG</th>
<th data-quarto-table-cell-role="th">ADM0_A3_MA</th>
<th data-quarto-table-cell-role="th">ADM0_A3_PT</th>
<th data-quarto-table-cell-role="th">ADM0_A3_AR</th>
<th data-quarto-table-cell-role="th">ADM0_A3_JP</th>
<th data-quarto-table-cell-role="th">ADM0_A3_KO</th>
<th data-quarto-table-cell-role="th">ADM0_A3_VN</th>
<th data-quarto-table-cell-role="th">ADM0_A3_TR</th>
<th data-quarto-table-cell-role="th">ADM0_A3_ID</th>
<th data-quarto-table-cell-role="th">ADM0_A3_PL</th>
<th data-quarto-table-cell-role="th">ADM0_A3_GR</th>
<th data-quarto-table-cell-role="th">ADM0_A3_IT</th>
<th data-quarto-table-cell-role="th">ADM0_A3_NL</th>
<th data-quarto-table-cell-role="th">ADM0_A3_SE</th>
<th data-quarto-table-cell-role="th">ADM0_A3_BD</th>
<th data-quarto-table-cell-role="th">ADM0_A3_UA</th>
<th data-quarto-table-cell-role="th">ADM0_A3_UN</th>
<th data-quarto-table-cell-role="th">ADM0_A3_WB</th>
<th data-quarto-table-cell-role="th">CONTINENT</th>
<th data-quarto-table-cell-role="th">REGION_UN</th>
<th data-quarto-table-cell-role="th">SUBREGION</th>
<th data-quarto-table-cell-role="th">REGION_WB</th>
<th data-quarto-table-cell-role="th">NAME_LEN</th>
<th data-quarto-table-cell-role="th">LONG_LEN</th>
<th data-quarto-table-cell-role="th">ABBREV_LEN</th>
<th data-quarto-table-cell-role="th">TINY</th>
<th data-quarto-table-cell-role="th">HOMEPART</th>
<th data-quarto-table-cell-role="th">MIN_ZOOM</th>
<th data-quarto-table-cell-role="th">MIN_LABEL</th>
<th data-quarto-table-cell-role="th">MAX_LABEL</th>
<th data-quarto-table-cell-role="th">LABEL_X</th>
<th data-quarto-table-cell-role="th">LABEL_Y</th>
<th data-quarto-table-cell-role="th">NE_ID</th>
<th data-quarto-table-cell-role="th">WIKIDATAID</th>
<th data-quarto-table-cell-role="th">NAME_AR</th>
<th data-quarto-table-cell-role="th">NAME_BN</th>
<th data-quarto-table-cell-role="th">NAME_DE</th>
<th data-quarto-table-cell-role="th">NAME_EN</th>
<th data-quarto-table-cell-role="th">NAME_ES</th>
<th data-quarto-table-cell-role="th">NAME_FA</th>
<th data-quarto-table-cell-role="th">NAME_FR</th>
<th data-quarto-table-cell-role="th">NAME_EL</th>
<th data-quarto-table-cell-role="th">NAME_HE</th>
<th data-quarto-table-cell-role="th">NAME_HI</th>
<th data-quarto-table-cell-role="th">NAME_HU</th>
<th data-quarto-table-cell-role="th">NAME_ID</th>
<th data-quarto-table-cell-role="th">NAME_IT</th>
<th data-quarto-table-cell-role="th">NAME_JA</th>
<th data-quarto-table-cell-role="th">NAME_KO</th>
<th data-quarto-table-cell-role="th">NAME_NL</th>
<th data-quarto-table-cell-role="th">NAME_PL</th>
<th data-quarto-table-cell-role="th">NAME_PT</th>
<th data-quarto-table-cell-role="th">NAME_RU</th>
<th data-quarto-table-cell-role="th">NAME_SV</th>
<th data-quarto-table-cell-role="th">NAME_TR</th>
<th data-quarto-table-cell-role="th">NAME_UK</th>
<th data-quarto-table-cell-role="th">NAME_UR</th>
<th data-quarto-table-cell-role="th">NAME_VI</th>
<th data-quarto-table-cell-role="th">NAME_ZH</th>
<th data-quarto-table-cell-role="th">NAME_ZHT</th>
<th data-quarto-table-cell-role="th">FCLASS_ISO</th>
<th data-quarto-table-cell-role="th">TLC_DIFF</th>
<th data-quarto-table-cell-role="th">FCLASS_TLC</th>
<th data-quarto-table-cell-role="th">FCLASS_US</th>
<th data-quarto-table-cell-role="th">FCLASS_FR</th>
<th data-quarto-table-cell-role="th">FCLASS_RU</th>
<th data-quarto-table-cell-role="th">FCLASS_ES</th>
<th data-quarto-table-cell-role="th">FCLASS_CN</th>
<th data-quarto-table-cell-role="th">FCLASS_TW</th>
<th data-quarto-table-cell-role="th">FCLASS_IN</th>
<th data-quarto-table-cell-role="th">FCLASS_NP</th>
<th data-quarto-table-cell-role="th">FCLASS_PK</th>
<th data-quarto-table-cell-role="th">FCLASS_DE</th>
<th data-quarto-table-cell-role="th">FCLASS_GB</th>
<th data-quarto-table-cell-role="th">FCLASS_BR</th>
<th data-quarto-table-cell-role="th">FCLASS_IL</th>
<th data-quarto-table-cell-role="th">FCLASS_PS</th>
<th data-quarto-table-cell-role="th">FCLASS_SA</th>
<th data-quarto-table-cell-role="th">FCLASS_EG</th>
<th data-quarto-table-cell-role="th">FCLASS_MA</th>
<th data-quarto-table-cell-role="th">FCLASS_PT</th>
<th data-quarto-table-cell-role="th">FCLASS_AR</th>
<th data-quarto-table-cell-role="th">FCLASS_JP</th>
<th data-quarto-table-cell-role="th">FCLASS_KO</th>
<th data-quarto-table-cell-role="th">FCLASS_VN</th>
<th data-quarto-table-cell-role="th">FCLASS_TR</th>
<th data-quarto-table-cell-role="th">FCLASS_ID</th>
<th data-quarto-table-cell-role="th">FCLASS_PL</th>
<th data-quarto-table-cell-role="th">FCLASS_GR</th>
<th data-quarto-table-cell-role="th">FCLASS_IT</th>
<th data-quarto-table-cell-role="th">FCLASS_NL</th>
<th data-quarto-table-cell-role="th">FCLASS_SE</th>
<th data-quarto-table-cell-role="th">FCLASS_BD</th>
<th data-quarto-table-cell-role="th">FCLASS_UA</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Admin-0 country</td>
<td>1</td>
<td>3</td>
<td>Zimbabwe</td>
<td>ZWE</td>
<td>0</td>
<td>2</td>
<td>Sovereign country</td>
<td>1</td>
<td>Zimbabwe</td>
<td>ZWE</td>
<td>0</td>
<td>Zimbabwe</td>
<td>ZWE</td>
<td>0</td>
<td>Zimbabwe</td>
<td>ZWE</td>
<td>0</td>
<td>Zimbabwe</td>
<td>Zimbabwe</td>
<td>ZWE</td>
<td>Zimbabwe</td>
<td>NaN</td>
<td>Zimb.</td>
<td>ZW</td>
<td>Republic of Zimbabwe</td>
<td>NaN</td>
<td>Zimbabwe</td>
<td>NaN</td>
<td>NaN</td>
<td>Zimbabwe</td>
<td>NaN</td>
<td>1</td>
<td>5</td>
<td>3</td>
<td>9</td>
<td>14645468.0</td>
<td>14</td>
<td>2019</td>
<td>21440</td>
<td>2019</td>
<td>5. Emerging region: G20</td>
<td>5. Low income</td>
<td>ZI</td>
<td>ZW</td>
<td>ZW</td>
<td>ZWE</td>
<td>ZWE</td>
<td>716</td>
<td>716</td>
<td>716</td>
<td>ZW</td>
<td>ZWE</td>
<td>23425004</td>
<td>23425004</td>
<td>Exact WOE match as country</td>
<td>ZWE</td>
<td>NaN</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>ZWE</td>
<td>-99</td>
<td>-99</td>
<td>Africa</td>
<td>Africa</td>
<td>Eastern Africa</td>
<td>Sub-Saharan Africa</td>
<td>8</td>
<td>8</td>
<td>5</td>
<td>-99</td>
<td>1</td>
<td>0.0</td>
<td>2.5</td>
<td>8.0</td>
<td>29.925444</td>
<td>-18.911640</td>
<td>1159321441</td>
<td>Q954</td>
<td>زيمبابوي</td>
<td>জিম্বাবুয়ে</td>
<td>Simbabwe</td>
<td>Zimbabwe</td>
<td>Zimbabue</td>
<td>زیمبابوه</td>
<td>Zimbabwe</td>
<td>Ζιμπάμπουε</td>
<td>זימבבואה</td>
<td>ज़िम्बाब्वे</td>
<td>Zimbabwe</td>
<td>Zimbabwe</td>
<td>Zimbabwe</td>
<td>ジンバブエ</td>
<td>짐바브웨</td>
<td>Zimbabwe</td>
<td>Zimbabwe</td>
<td>Zimbábue</td>
<td>Зимбабве</td>
<td>Zimbabwe</td>
<td>Zimbabve</td>
<td>Зімбабве</td>
<td>زمبابوے</td>
<td>Zimbabwe</td>
<td>津巴布韦</td>
<td>辛巴威</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((31.28789 -22.40205, 31.19727 -22.344...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Admin-0 country</td>
<td>1</td>
<td>3</td>
<td>Zambia</td>
<td>ZMB</td>
<td>0</td>
<td>2</td>
<td>Sovereign country</td>
<td>1</td>
<td>Zambia</td>
<td>ZMB</td>
<td>0</td>
<td>Zambia</td>
<td>ZMB</td>
<td>0</td>
<td>Zambia</td>
<td>ZMB</td>
<td>0</td>
<td>Zambia</td>
<td>Zambia</td>
<td>ZMB</td>
<td>Zambia</td>
<td>NaN</td>
<td>Zambia</td>
<td>ZM</td>
<td>Republic of Zambia</td>
<td>NaN</td>
<td>Zambia</td>
<td>NaN</td>
<td>NaN</td>
<td>Zambia</td>
<td>NaN</td>
<td>5</td>
<td>8</td>
<td>5</td>
<td>13</td>
<td>17861030.0</td>
<td>14</td>
<td>2019</td>
<td>23309</td>
<td>2019</td>
<td>7. Least developed region</td>
<td>4. Lower middle income</td>
<td>ZA</td>
<td>ZM</td>
<td>ZM</td>
<td>ZMB</td>
<td>ZMB</td>
<td>894</td>
<td>894</td>
<td>894</td>
<td>ZM</td>
<td>ZMB</td>
<td>23425003</td>
<td>23425003</td>
<td>Exact WOE match as country</td>
<td>ZMB</td>
<td>NaN</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>ZMB</td>
<td>-99</td>
<td>-99</td>
<td>Africa</td>
<td>Africa</td>
<td>Eastern Africa</td>
<td>Sub-Saharan Africa</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>-99</td>
<td>1</td>
<td>0.0</td>
<td>3.0</td>
<td>8.0</td>
<td>26.395298</td>
<td>-14.660804</td>
<td>1159321439</td>
<td>Q953</td>
<td>زامبيا</td>
<td>জাম্বিয়া</td>
<td>Sambia</td>
<td>Zambia</td>
<td>Zambia</td>
<td>زامبیا</td>
<td>Zambie</td>
<td>Ζάμπια</td>
<td>זמביה</td>
<td>ज़ाम्बिया</td>
<td>Zambia</td>
<td>Zambia</td>
<td>Zambia</td>
<td>ザンビア</td>
<td>잠비아</td>
<td>Zambia</td>
<td>Zambia</td>
<td>Zâmbia</td>
<td>Замбия</td>
<td>Zambia</td>
<td>Zambiya</td>
<td>Замбія</td>
<td>زیمبیا</td>
<td>Zambia</td>
<td>赞比亚</td>
<td>尚比亞</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((30.39609 -15.64307, 30.25068 -15.643...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Admin-0 country</td>
<td>1</td>
<td>3</td>
<td>Yemen</td>
<td>YEM</td>
<td>0</td>
<td>2</td>
<td>Sovereign country</td>
<td>1</td>
<td>Yemen</td>
<td>YEM</td>
<td>0</td>
<td>Yemen</td>
<td>YEM</td>
<td>0</td>
<td>Yemen</td>
<td>YEM</td>
<td>0</td>
<td>Yemen</td>
<td>Yemen</td>
<td>YEM</td>
<td>Yemen</td>
<td>NaN</td>
<td>Yem.</td>
<td>YE</td>
<td>Republic of Yemen</td>
<td>NaN</td>
<td>Yemen</td>
<td>NaN</td>
<td>NaN</td>
<td>Yemen, Rep.</td>
<td>NaN</td>
<td>5</td>
<td>3</td>
<td>3</td>
<td>11</td>
<td>29161922.0</td>
<td>15</td>
<td>2019</td>
<td>22581</td>
<td>2019</td>
<td>7. Least developed region</td>
<td>4. Lower middle income</td>
<td>YM</td>
<td>YE</td>
<td>YE</td>
<td>YEM</td>
<td>YEM</td>
<td>887</td>
<td>887</td>
<td>887</td>
<td>RY</td>
<td>YEM</td>
<td>23425002</td>
<td>23425002</td>
<td>Exact WOE match as country</td>
<td>YEM</td>
<td>NaN</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>YEM</td>
<td>-99</td>
<td>-99</td>
<td>Asia</td>
<td>Asia</td>
<td>Western Asia</td>
<td>Middle East &amp; North Africa</td>
<td>5</td>
<td>5</td>
<td>4</td>
<td>-99</td>
<td>1</td>
<td>0.0</td>
<td>3.0</td>
<td>8.0</td>
<td>45.874383</td>
<td>15.328226</td>
<td>1159321425</td>
<td>Q805</td>
<td>اليمن</td>
<td>ইয়েমেন</td>
<td>Jemen</td>
<td>Yemen</td>
<td>Yemen</td>
<td>یمن</td>
<td>Yémen</td>
<td>Υεμένη</td>
<td>תימן</td>
<td>यमन</td>
<td>Jemen</td>
<td>Yaman</td>
<td>Yemen</td>
<td>イエメン</td>
<td>예멘</td>
<td>Jemen</td>
<td>Jemen</td>
<td>Iémen</td>
<td>Йемен</td>
<td>Jemen</td>
<td>Yemen</td>
<td>Ємен</td>
<td>یمن</td>
<td>Yemen</td>
<td>也门</td>
<td>葉門</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>MULTIPOLYGON (((53.08564 16.64839, 52.58145 16...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Admin-0 country</td>
<td>3</td>
<td>2</td>
<td>Vietnam</td>
<td>VNM</td>
<td>0</td>
<td>2</td>
<td>Sovereign country</td>
<td>1</td>
<td>Vietnam</td>
<td>VNM</td>
<td>0</td>
<td>Vietnam</td>
<td>VNM</td>
<td>0</td>
<td>Vietnam</td>
<td>VNM</td>
<td>0</td>
<td>Vietnam</td>
<td>Vietnam</td>
<td>VNM</td>
<td>Vietnam</td>
<td>NaN</td>
<td>Viet.</td>
<td>VN</td>
<td>Socialist Republic of Vietnam</td>
<td>NaN</td>
<td>Vietnam</td>
<td>NaN</td>
<td>NaN</td>
<td>Vietnam</td>
<td>NaN</td>
<td>5</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>96462106.0</td>
<td>16</td>
<td>2019</td>
<td>261921</td>
<td>2019</td>
<td>5. Emerging region: G20</td>
<td>4. Lower middle income</td>
<td>VM</td>
<td>VN</td>
<td>VN</td>
<td>VNM</td>
<td>VNM</td>
<td>704</td>
<td>704</td>
<td>704</td>
<td>VN</td>
<td>VNM</td>
<td>23424984</td>
<td>23424984</td>
<td>Exact WOE match as country</td>
<td>VNM</td>
<td>NaN</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>VNM</td>
<td>-99</td>
<td>-99</td>
<td>Asia</td>
<td>Asia</td>
<td>South-Eastern Asia</td>
<td>East Asia &amp; Pacific</td>
<td>7</td>
<td>7</td>
<td>5</td>
<td>2</td>
<td>1</td>
<td>0.0</td>
<td>2.0</td>
<td>7.0</td>
<td>105.387292</td>
<td>21.715416</td>
<td>1159321417</td>
<td>Q881</td>
<td>فيتنام</td>
<td>ভিয়েতনাম</td>
<td>Vietnam</td>
<td>Vietnam</td>
<td>Vietnam</td>
<td>ویتنام</td>
<td>Viêt Nam</td>
<td>Βιετνάμ</td>
<td>וייטנאם</td>
<td>वियतनाम</td>
<td>Vietnám</td>
<td>Vietnam</td>
<td>Vietnam</td>
<td>ベトナム</td>
<td>베트남</td>
<td>Vietnam</td>
<td>Wietnam</td>
<td>Vietname</td>
<td>Вьетнам</td>
<td>Vietnam</td>
<td>Vietnam</td>
<td>В'єтнам</td>
<td>ویتنام</td>
<td>Việt Nam</td>
<td>越南</td>
<td>越南</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>MULTIPOLYGON (((104.06396 10.39082, 104.08301 ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Admin-0 country</td>
<td>5</td>
<td>3</td>
<td>Venezuela</td>
<td>VEN</td>
<td>0</td>
<td>2</td>
<td>Sovereign country</td>
<td>1</td>
<td>Venezuela</td>
<td>VEN</td>
<td>0</td>
<td>Venezuela</td>
<td>VEN</td>
<td>0</td>
<td>Venezuela</td>
<td>VEN</td>
<td>0</td>
<td>Venezuela</td>
<td>Venezuela</td>
<td>VEN</td>
<td>Venezuela</td>
<td>NaN</td>
<td>Ven.</td>
<td>VE</td>
<td>Bolivarian Republic of Venezuela</td>
<td>República Bolivariana de Venezuela</td>
<td>Venezuela</td>
<td>NaN</td>
<td>NaN</td>
<td>Venezuela, RB</td>
<td>NaN</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>4</td>
<td>28515829.0</td>
<td>15</td>
<td>2019</td>
<td>482359</td>
<td>2014</td>
<td>5. Emerging region: G20</td>
<td>3. Upper middle income</td>
<td>VE</td>
<td>VE</td>
<td>VE</td>
<td>VEN</td>
<td>VEN</td>
<td>862</td>
<td>862</td>
<td>862</td>
<td>VE</td>
<td>VEN</td>
<td>23424982</td>
<td>23424982</td>
<td>Exact WOE match as country</td>
<td>VEN</td>
<td>NaN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>VEN</td>
<td>-99</td>
<td>-99</td>
<td>South America</td>
<td>Americas</td>
<td>South America</td>
<td>Latin America &amp; Caribbean</td>
<td>9</td>
<td>9</td>
<td>4</td>
<td>-99</td>
<td>1</td>
<td>0.0</td>
<td>2.5</td>
<td>7.5</td>
<td>-64.599381</td>
<td>7.182476</td>
<td>1159321411</td>
<td>Q717</td>
<td>فنزويلا</td>
<td>ভেনেজুয়েলা</td>
<td>Venezuela</td>
<td>Venezuela</td>
<td>Venezuela</td>
<td>ونزوئلا</td>
<td>Venezuela</td>
<td>Βενεζουέλα</td>
<td>ונצואלה</td>
<td>वेनेज़ुएला</td>
<td>Venezuela</td>
<td>Venezuela</td>
<td>Venezuela</td>
<td>ベネズエラ</td>
<td>베네수엘라</td>
<td>Venezuela</td>
<td>Wenezuela</td>
<td>Venezuela</td>
<td>Венесуэла</td>
<td>Venezuela</td>
<td>Venezuela</td>
<td>Венесуела</td>
<td>وینیزویلا</td>
<td>Venezuela</td>
<td>委内瑞拉</td>
<td>委內瑞拉</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>Admin-0 country</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>MULTIPOLYGON (((-60.82119 9.13838, -60.94141 9...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Taking a quick look at this dataset:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quick view</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>countries.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-10-merge-data_files/figure-html/cell-7-output-2.png" width="577" height="293"></p>
</div>
</div>
<p>Notice the column names are in all caps. It is easier to work with column names in small caps because we don’t need to be pressing shift or capslock. We can do this update like this:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-assign the column names: .str.lower() makes them lower case</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>countries.columns <span class="op">=</span> countries.columns.<span class="bu">str</span>.lower()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(countries.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['featurecla', 'scalerank', 'labelrank', 'sovereignt', 'sov_a3',
       'adm0_dif', 'level', 'type', 'tlc', 'admin',
       ...
       'fclass_tr', 'fclass_id', 'fclass_pl', 'fclass_gr', 'fclass_it',
       'fclass_nl', 'fclass_se', 'fclass_bd', 'fclass_ua', 'geometry'],
      dtype='object', length=169)</code></pre>
</div>
</div>
<p>Finally, we have too many columns, so let’s only keep a few*:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remeber: the geometry column has the polygons for each country</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>countries_sub <span class="op">=</span> countries[[<span class="st">'admin'</span>,<span class="st">'type'</span>,<span class="st">'geometry'</span>]]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>countries_sub.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">admin</th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Zimbabwe</td>
<td>Sovereign country</td>
<td>POLYGON ((31.28789 -22.40205, 31.19727 -22.344...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Zambia</td>
<td>Sovereign country</td>
<td>POLYGON ((30.39609 -15.64307, 30.25068 -15.643...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Yemen</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((53.08564 16.64839, 52.58145 16...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Vietnam</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((104.06396 10.39082, 104.08301 ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Venezuela</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((-60.82119 9.13838, -60.94141 9...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="arctic-communities" class="level3" data-number="13.4.2">
<h3 data-number="13.4.2" class="anchored" data-anchor-id="arctic-communities"><span class="header-section-number">13.4.2</span> Arctic communities</h3>
<p>In the same way as we previously used <code>pandas.read_csv()</code>, we can read in the Arctic communities data directly from the data repository using <code>geopandas.read_file()</code>:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in Arctic communities data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>communities <span class="op">=</span> gpd.read_file(<span class="st">'https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Aed7718ae-fb0d-43dd-9270-fbfe80bfc7a4'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>communities.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">geoname-id</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Udomlya</td>
<td>32373</td>
<td>RU</td>
<td>452949</td>
<td>POINT (34.99250 57.87944)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Valmiera</td>
<td>26963</td>
<td>LV</td>
<td>453754</td>
<td>POINT (25.42751 57.54108)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Ventspils</td>
<td>42644</td>
<td>LV</td>
<td>454310</td>
<td>POINT (21.57288 57.38988)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Vec-Liepāja</td>
<td>85260</td>
<td>LV</td>
<td>454432</td>
<td>POINT (21.01667 56.53333)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Tukums</td>
<td>18348</td>
<td>LV</td>
<td>454768</td>
<td>POINT (23.15528 56.96694)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice that the <code>countries</code> and <code>communities</code> GeoDataFrames both have the same crs:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>countries.crs <span class="op">==</span> communities.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>True</code></pre>
</div>
</div>
<p>This makes it easy to take a quick look at our communities data by plotting it on top of the countries dataframe:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>countries.plot(ax<span class="op">=</span>ax)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>communities.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lesson-10-merge-data_files/figure-html/cell-12-output-1.png" width="403" height="411"></p>
</div>
</div>
<p>Next, we want to calculate the number of Arctic communities by country.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate number of communities by country</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract number of communities by country as a pd.Series</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>n_comms <span class="op">=</span> communities.groupby(<span class="st">'country'</span>).count().name</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the pd.Series into a pd.DataFrame and update it</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>n_comms <span class="op">=</span> pd.DataFrame(n_comms).rename(columns<span class="op">=</span>{<span class="st">'name'</span>:<span class="st">'n_communities'</span>}).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s break this down a bit:</p>
<ul>
<li>We start with our <code>communities</code> dataframe and use <code>groupby('country')</code> to group by country code,</li>
<li>then we use <code>count()</code> as an aggregator function to count how many rows belong to each country code.</li>
<li>The result of this operation is a dataframe (run <code>communities.groupby('country').count()</code> to check) and we select a single column with the counts by selecting the <code>name</code> column.</li>
<li>The result is a single <code>pd.Series</code> in the variable <code>n_comms</code>.</li>
<li>We then convert this <code>pd.Series</code> into a <code>pd.DataFrame</code> and clean it up a bit.</li>
</ul>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of communities per country</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>n_comms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">n_communities</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AX</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BY</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>CA</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>DK</td>
<td>72</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>EE</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>FI</td>
<td>98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>FO</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>GB</td>
<td>96</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>GL</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>IS</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>LT</td>
<td>26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>LV</td>
<td>25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>NO</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>RU</td>
<td>774</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SE</td>
<td>133</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>US</td>
<td>115</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Since we only want data from Scandinavia, we can use the codes for these countries to locate these rows:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select Scandinavia data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>scandi_codes <span class="op">=</span> [<span class="st">'DK'</span>,<span class="st">'NO'</span>,<span class="st">'SE'</span>,<span class="st">'FO'</span>,<span class="st">'FI'</span>,<span class="st">'IS'</span>,<span class="st">'AX'</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>scandi_n_comms <span class="op">=</span> n_comms[n_comms.country.isin(scandi_codes)].copy()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>scandi_n_comms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">n_communities</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AX</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>DK</td>
<td>72</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>FI</td>
<td>98</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>FO</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>IS</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>NO</td>
<td>48</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SE</td>
<td>133</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="merge-datasets" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="merge-datasets"><span class="header-section-number">13.5</span> Merge datasets</h2>
<p>To merge two datasets they need to have at least one column in common. Currently our datasets do not have any columns in common:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>countries_sub.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">admin</th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Zimbabwe</td>
<td>Sovereign country</td>
<td>POLYGON ((31.28789 -22.40205, 31.19727 -22.344...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Zambia</td>
<td>Sovereign country</td>
<td>POLYGON ((30.39609 -15.64307, 30.25068 -15.643...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>scandi_n_comms.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">n_communities</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AX</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>DK</td>
<td>72</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can easily fix this by adding an <code>admin</code> column to <code>scandi_n_comms</code>:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add country names </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>scandi_names <span class="op">=</span> [<span class="st">'Aland Islands'</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Denmark'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Finland'</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Faroe Islands'</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Iceland'</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Norway'</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Sweden'</span>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>scandi_n_comms[<span class="st">'admin'</span>] <span class="op">=</span> scandi_names</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>scandi_n_comms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">n_communities</th>
<th data-quarto-table-cell-role="th">admin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AX</td>
<td>1</td>
<td>Aland Islands</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>DK</td>
<td>72</td>
<td>Denmark</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>FI</td>
<td>98</td>
<td>Finland</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>FO</td>
<td>1</td>
<td>Faroe Islands</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>IS</td>
<td>5</td>
<td>Iceland</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>NO</td>
<td>48</td>
<td>Norway</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SE</td>
<td>133</td>
<td>Sweden</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To merge dataframes we can use the <a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html#pandas.merge"><code>pandas.merge()</code> function</a>. The basic syntax for it is:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>output_df <span class="op">=</span> pd.merge(left_df,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                     right_df, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                     how <span class="op">=</span> type_of_join, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                     on <span class="op">=</span> column_to_join)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where</p>
<ul>
<li><code>output_df</code> is the dataframe resulting from the merge,</li>
<li><code>left_df</code> is the dataframe we have “on the left side”,</li>
<li><code>right_df</code> is the dataframe we have “on the right side”,</li>
<li><code>how</code> specifies the type of join between the left and right dataframes, (<a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html#pandas.merge">check the options here</a>), the default is to do an inner join,</li>
<li><code>on</code> specifies the column to join on, this column must be present in both our dataframes.</li>
</ul>
<p>In our case we want to perform an inner join between our dataframes. This will merge the subset of rows that have matches in both the left table and the right table.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/merging_data/join-diagrams-inner.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Image source: Data Modeling Essentials, NCEAS Learning Hub</figcaption>
</figure>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge dataframes </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>scandi_countries <span class="op">=</span> pd.merge(countries_sub,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                            scandi_n_comms,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                            how<span class="op">=</span><span class="st">'inner'</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                            on<span class="op">=</span><span class="st">'admin'</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># update index</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>scandi_countries <span class="op">=</span> scandi_countries.set_index(<span class="st">'admin'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>scandi_countries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">n_communities</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">admin</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sweden</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((19.07646 57.83594, 18.99375 57...</td>
<td>SE</td>
<td>133</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Norway</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((20.62217 69.03687, 20.49199 69...</td>
<td>NO</td>
<td>48</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Iceland</td>
<td>Sovereign country</td>
<td>POLYGON ((-15.54312 66.22852, -15.42847 66.224...</td>
<td>IS</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Finland</td>
<td>Country</td>
<td>MULTIPOLYGON (((24.15547 65.80527, 24.04902 65...</td>
<td>FI</td>
<td>98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Faroe Islands</td>
<td>Dependency</td>
<td>MULTIPOLYGON (((-6.62319 61.80596, -6.64277 61...</td>
<td>FO</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Denmark</td>
<td>Country</td>
<td>MULTIPOLYGON (((12.56875 55.78506, 12.57119 55...</td>
<td>DK</td>
<td>72</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice that the row for Aland Islands is not present in the merged dataframe. We can verify the value ‘Aland Islands’ was <em>nowhere</em> in our original countries dataframe like this:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check Aland Islands is nowhere in data frame</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">'Aland Islands'</span> <span class="kw">in</span> countries.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>False</code></pre>
</div>
</div>
<p>The <code>values</code> attribute of a dataframe returns all the values in the dataframe as an array:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the underlying values of the dataframe</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>countries.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array([['Admin-0 country', 1, 3, ..., nan, nan,
        &lt;POLYGON ((31.288 -22.402, 31.197 -22.345, 31.073 -22.308, 30.916 -22.291, 3...&gt;],
       ['Admin-0 country', 1, 3, ..., nan, nan,
        &lt;POLYGON ((30.396 -15.643, 30.251 -15.643, 29.995 -15.644, 29.73 -15.645, 29...&gt;],
       ['Admin-0 country', 1, 3, ..., nan, nan,
        &lt;MULTIPOLYGON (((53.086 16.648, 52.581 16.47, 52.448 16.391, 52.328 16.294, ...&gt;],
       ...,
       ['Admin-0 country', 3, 4, ..., nan, nan,
        &lt;MULTIPOLYGON (((-45.718 -60.521, -45.5 -60.546, -45.386 -60.583, -45.357 -6...&gt;],
       ['Admin-0 country', 3, 6, ..., nan, nan,
        &lt;POLYGON ((-63.123 18.069, -63.011 18.069, -63.012 18.045, -63.023 18.019, -...&gt;],
       ['Admin-0 country', 5, 6, ..., nan, nan,
        &lt;POLYGON ((179.214 -8.524, 179.201 -8.535, 179.196 -8.535, 179.201 -8.512, 1...&gt;]],
      dtype=object)</code></pre>
</div>
</div>
<p>The Aland Islands is an autonomous region of Finland and there is one Arctic community registered in this region. We will directly add one to Finland to not lose this piece of data:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>scandi_countries.at[<span class="st">'Finland'</span>, <span class="st">'n_communities'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(scandi_countries.at[<span class="st">'Finland'</span>, <span class="st">'n_communities'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>99</code></pre>
</div>
</div>
</section>
<section id="choropleth-map" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="choropleth-map"><span class="header-section-number">13.6</span> Choropleth map</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Choropleth_map">choropleth map</a> is an efficient way to visualize aggregate data per region.</p>
<p>To make a choropleth map from our polygons <code>GeoDataFrame</code> we need to specify the <code>column</code> parameter in <code>plot()</code> and make it equal to the column with the values we want to plot in each country.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>scandi_countries.plot(column<span class="op">=</span><span class="st">'n_communities'</span>,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                      legend<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-10-merge-data_files/figure-html/cell-23-output-2.png" width="442" height="411"></p>
</div>
</div>
<p>To finish, we can use <code>matplotlib</code> to customize our map:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#countries.plot(ax=ax)</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>scandi_countries.plot(ax<span class="op">=</span>ax,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                      column<span class="op">=</span><span class="st">'n_communities'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                       cmap<span class="op">=</span><span class="st">'BuPu'</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                       legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                       edgecolor<span class="op">=</span><span class="st">"0.8"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                       legend_kwds<span class="op">=</span>{<span class="st">"shrink"</span>:<span class="fl">.8</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'label'</span>: <span class="st">"Number of Arctic communities"</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                                    }</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Arctic communities in Scandinavia'</span>,  fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Longitude'</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Latitude'</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lesson-10-merge-data_files/figure-html/cell-24-output-1.png" width="484" height="435"></p>
</div>
</div>
<p><strong>Check-in</strong></p>
<p>Add the scandinavian communities as dots on the choropleth map.</p>
</section>
<section id="complete-workflow" class="level2" data-number="13.7">
<h2 data-number="13.7" class="anchored" data-anchor-id="complete-workflow"><span class="header-section-number">13.7</span> Complete workflow</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import libraries</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= IMPORT DATA ========</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># read in Arctic communities data</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>communities <span class="op">=</span> gpd.read_file(<span class="st">'https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Aed7718ae-fb0d-43dd-9270-fbfe80bfc7a4'</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># import countries polygons</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> gpd.read_file(<span class="st">'ne_50m_admin_0_countries/ne_50m_admin_0_countries.shp'</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>countries.head()</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= COUNTRIES PREPARATION =======</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># make column names lower case</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>countries.columns <span class="op">=</span> countries.columns.<span class="bu">str</span>.lower()</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># select a subset of the columns</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>countries_sub <span class="op">=</span> countries[[<span class="st">'admin'</span>,<span class="st">'type'</span>,<span class="st">'geometry'</span>]]</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= COMMUNITIES PREPARATION =======</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co"># extract number of communities by country as a pd.Series</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>n_comms <span class="op">=</span> communities.groupby(<span class="st">'country'</span>).count().name</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the pd.Series into a pd.DataFrame and update it</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>n_comms <span class="op">=</span> pd.DataFrame(n_comms).rename(columns<span class="op">=</span>{<span class="st">'name'</span>:<span class="st">'n_communities'</span>}).reset_index()</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co"># select Scandinavia data</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>scandi_codes <span class="op">=</span> [<span class="st">'DK'</span>,<span class="st">'NO'</span>,<span class="st">'SE'</span>,<span class="st">'FO'</span>,<span class="st">'FI'</span>,<span class="st">'IS'</span>,<span class="st">'AX'</span>]</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>scandi_n_comms <span class="op">=</span> n_comms[n_comms.country.isin(scandi_codes)].copy()</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="co"># select communities from Scandinavian countries</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>scandi_communities <span class="op">=</span> communities[communities.country.isin(scandi_codes)]</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>scandi_communities</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= MERGE DATASETS =======</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="co"># add names as admin column to scandi_n_comms</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>scandi_names <span class="op">=</span> [<span class="st">'Aland Islands'</span>,</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Denmark'</span>,</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Finland'</span>,</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Faroe Islands'</span>,</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Iceland'</span>,</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Norway'</span>,</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Sweden'</span>]</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>scandi_n_comms[<span class="st">'admin'</span>] <span class="op">=</span> scandi_names</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a><span class="co"># merge dataframes </span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>scandi_countries <span class="op">=</span> pd.merge(countries_sub,</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>                            scandi_n_comms,</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>                            how<span class="op">=</span><span class="st">'inner'</span>,</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>                            on<span class="op">=</span><span class="st">'admin'</span>)</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a><span class="co"># update index</span></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>scandi_countries <span class="op">=</span> scandi_countries.set_index(<span class="st">'admin'</span>)</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ======= CREATE MAP =======</span></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a><span class="co">#countries.plot(ax=ax)</span></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>scandi_countries.plot(ax<span class="op">=</span>ax,</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>                      column<span class="op">=</span><span class="st">'n_communities'</span>,</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>                       cmap<span class="op">=</span><span class="st">'BuPu'</span>,</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>                       legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>                       edgecolor<span class="op">=</span><span class="st">"0.8"</span>,</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>                       legend_kwds<span class="op">=</span>{<span class="st">"shrink"</span>:<span class="fl">.8</span>,</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'label'</span>: <span class="st">"Number of Arctic communities"</span></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>                                    }</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>scandi_communities.plot(ax<span class="op">=</span>ax, </span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>                        edgecolor<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Arctic communities in Scandinavia'</span>,  fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Longitude'</span>)</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Latitude'</span>)</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="acknowledgments" class="level2" data-number="13.8">
<h2 data-number="13.8" class="anchored" data-anchor-id="acknowledgments"><span class="header-section-number">13.8</span> Acknowledgments</h2>
<p>The section about merging data is based on the <a href="https://learning.nceas.ucsb.edu/2023-06-delta/session_09.html#merging-data">Data Modeling Essentials R lesson</a> from the NCEAS Learning Hub.</p>
<p>Halina Do-Linh, Carmen Galaz García, Matthew B. Jones, Camila Vargas Poulsen. 2023. Open Science Synthesis training Week 1. NCEAS Learning Hub &amp; Delta Stewardship Council.</p>
</section>
<section id="references" class="level2" data-number="13.9">
<h2 data-number="13.9" class="anchored" data-anchor-id="references"><span class="header-section-number">13.9</span> References</h2>
<p>Mike Brook. (2023). Approximate Arctic Communities and Populations, (latitude &gt;= 55, 2022). Arctic Data Center. doi:10.18739/A28S4JQ80.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../lectures/lesson-9-geopandas-intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title"><code>geopandas</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../lectures/lesson-12-csv-to-geo.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">csv to <code>GeoDataFrame</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>