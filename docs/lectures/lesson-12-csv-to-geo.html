<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EDS 220 - Working with Environmental Datasets - 14&nbsp; cvs to GeoDataFrame</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../lectures/lesson-11-crs.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">cvs to <code>GeoDataFrame</code></span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">EDS 220 - Working with Environmental Datasets</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Welcome!</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-1-python-review.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Review</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">pandas</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-2-series-dataframes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><code>pd.Series</code> and <code>pd.DataFrames</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds1-anthr-prelim-data-exploration.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">* Lab: Preliminary data exploration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-3-pandas-subsetting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Subsetting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-4-basic-plotting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Plotting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-5-updating-dataframes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Updating data frames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-6-groupby.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><code>groupby()</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../discussion-sections/ds2-hares.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">* Lab: Data cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-7-time-series.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Basic time series</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">geopandas</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-8-vector-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Vector data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-9-geopandas-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><code>geopandas</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-10-merge-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Merging data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-11-crs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Coordinate Reference Systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/lesson-12-csv-to-geo.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">cvs to <code>GeoDataFrame</code></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data"><span class="toc-section-number">14.1</span>  Data</a></li>
  <li><a href="#dataframe-to-geodataframe" id="toc-dataframe-to-geodataframe" class="nav-link" data-scroll-target="#dataframe-to-geodataframe"><span class="toc-section-number">14.2</span>  <code>DataFrame</code> to <code>GeoDataFrame</code></a></li>
  <li><a href="#tiger-shapefile" id="toc-tiger-shapefile" class="nav-link" data-scroll-target="#tiger-shapefile"><span class="toc-section-number">14.3</span>  TIGER shapefile</a></li>
  <li><a href="#data-selection" id="toc-data-selection" class="nav-link" data-scroll-target="#data-selection"><span class="toc-section-number">14.4</span>  Data selection</a></li>
  <li><a href="#plotting" id="toc-plotting" class="nav-link" data-scroll-target="#plotting"><span class="toc-section-number">14.5</span>  Plotting</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">cvs to <code>GeoDataFrame</code></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- 
Fixing the preview working directory

::: {.cell execution_count=1}
``` {.python .cell-code}
import os
home = os.path.expanduser("~")
os.chdir(os.path.join(home,'eds-220-book'))
```
:::


Ignore ShapelyDeprecationWarning warning in render

::: {.cell execution_count=2}
``` {.python .cell-code}
import shapely
import warnings
from shapely.errors import ShapelyDeprecationWarning

warnings.filterwarnings("ignore", category=ShapelyDeprecationWarning) 
```
:::


-->
<p>In this lesson we will learn how to make a csv into a <code>geopandas.GeoDataFrame</code>, setting its CRS manually and learn some more customizations for maps and matplotlib figures.</p>
<section id="data" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="data"><span class="header-section-number">14.1</span> Data</h2>
<p>We will use two datasets in this lesson. The first one is a reprojection of this dataset from the U.S. Energy Information Administration (EIA) with <a href="https://atlas.eia.gov/datasets/eia::power-plants/about">information about operable electric generating plants in the United States by energy source, as of May 2023</a>.</p>
<p>Follow these steps to download the <em>reprojected</em> datset for this lesson:</p>
<ol type="1">
<li>Go to https://github.com/carmengg/eds-220-book/blob/main/data/power_plants_epsg4269.csv</li>
<li>Download the raw file and move it into your working directory</li>
</ol>
<p>You can <a href="https://eia.maps.arcgis.com/sharing/rest/content/items/bf5c5110b1b944d299bb683cdbd02d2a/info/metadata/metadata.xml?format=default&amp;output=html">access the metadata for this dataset here</a>.</p>
<p>The second dataset is a <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.2022.html#list-tab-790442341">TIGER shapefile from the United States Census Bureau</a>. TIGER stands for <a href="https://en.wikipedia.org/wiki/Topologically_Integrated_Geographic_Encoding_and_Referencing">Topologically Integrated Geographic Encoding and Referencing</a>. This used to be the data format the US Census distributed geospatial data, but since 2008 TIGER files are converted to shapefiles. We will use the shapefiles for the US states. Follow these steps to download shapefile with the United States’ states:</p>
<ol type="1">
<li>At the bottom of the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.2022.html#list-tab-790442341">2022 page</a>, under Download, click on “Web Interface”</li>
<li>For year, select 2022, and for layer type select “States (and equivalent)”. Click submit.</li>
<li>Click on “Download national file”.</li>
</ol>
<p>You can check the <a href="https://www.census.gov/programs-surveys/geography/technical-documentation/complete-technical-documentation/tiger-geo-line.html">metadata for all the TIGER shapefiles here</a>. The columns for this shapefile are:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/tiger_shp_columns.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Source: TIGER/Line Shapefiles Technical Documentation</figcaption><p></p>
</figure>
</div>
<p><strong>File management: Both datasets must be in a data directory inside your working directory.</strong></p>
</section>
<section id="dataframe-to-geodataframe" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="dataframe-to-geodataframe"><span class="header-section-number">14.2</span> <code>DataFrame</code> to <code>GeoDataFrame</code></h2>
<p>Let’s start by importing the necessary libraries:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And update pandas display options:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display all column when looking at dataframes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.max.columns"</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our first step is to import the power plants dataset. Notice this is a csv, geopandas doesn’t have a way to extract a geometry column from a csv, so we will need to create this geometry manually. We start by reading in the data using <code>pandas</code>.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import power plants data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>power_plants <span class="op">=</span> pd.read_csv(<span class="st">'data/power_plants_epsg4269.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>power_plants.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Unnamed: 0</th>
      <th>objectid</th>
      <th>plant_code</th>
      <th>plant_name</th>
      <th>utility_id</th>
      <th>utility_name</th>
      <th>sector_name</th>
      <th>street_address</th>
      <th>city</th>
      <th>county</th>
      <th>state</th>
      <th>zip</th>
      <th>primsource</th>
      <th>source_desc</th>
      <th>tech_desc</th>
      <th>install_mw</th>
      <th>total_mw</th>
      <th>bat_mw</th>
      <th>bio_mw</th>
      <th>coal_mw</th>
      <th>geo_mw</th>
      <th>hydro_mw</th>
      <th>hydrops_mw</th>
      <th>ng_mw</th>
      <th>nuclear_mw</th>
      <th>crude_mw</th>
      <th>solar_mw</th>
      <th>wind_mw</th>
      <th>other_mw</th>
      <th>source</th>
      <th>period</th>
      <th>longitude</th>
      <th>latitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>11570</td>
      <td>1</td>
      <td>Sand Point</td>
      <td>63560</td>
      <td>TDX Sand Point Generating, LLC</td>
      <td>Electric Utility</td>
      <td>100 Power Plant Way</td>
      <td>Sand Point</td>
      <td>Aleutians East</td>
      <td>Alaska</td>
      <td>99661.0</td>
      <td>petroleum</td>
      <td>Petroleum = 1.3 MW, Wind = 0.4 MW</td>
      <td>Petroleum Liquids; Onshore Wind Turbine;</td>
      <td>3.7</td>
      <td>1.7</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.3</td>
      <td>NaN</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>EIA-860, EIA-860M and EIA-923</td>
      <td>202305.0</td>
      <td>-160.497222</td>
      <td>55.339722</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>11571</td>
      <td>2</td>
      <td>Bankhead Dam</td>
      <td>195</td>
      <td>Alabama Power Co</td>
      <td>Electric Utility</td>
      <td>19001 Lock 17 Road</td>
      <td>Northport</td>
      <td>Tuscaloosa</td>
      <td>Alabama</td>
      <td>35476.0</td>
      <td>hydroelectric</td>
      <td>Hydroelectric = 53 MW</td>
      <td>Conventional Hydroelectric</td>
      <td>53.9</td>
      <td>53.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>53.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>EIA-860, EIA-860M and EIA-923</td>
      <td>202305.0</td>
      <td>-87.356823</td>
      <td>33.458665</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>11572</td>
      <td>3</td>
      <td>Barry</td>
      <td>195</td>
      <td>Alabama Power Co</td>
      <td>Electric Utility</td>
      <td>North Highway 43</td>
      <td>Bucks</td>
      <td>Mobile</td>
      <td>Alabama</td>
      <td>36512.0</td>
      <td>natural gas</td>
      <td>Coal = 1118.5 MW, Natural Gas = 1296.2 MW</td>
      <td>Conventional Steam Coal; Natural Gas Fired Com...</td>
      <td>2569.5</td>
      <td>2414.7</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1118.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1296.2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>EIA-860, EIA-860M and EIA-923</td>
      <td>202305.0</td>
      <td>-88.010300</td>
      <td>31.006900</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update column names to small caps</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>power_plants.columns <span class="op">=</span> power_plants.columns.<span class="bu">str</span>.lower()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This csv has longitude and latitude columns, which indicate the location of the power plants in the NAD83 CRS (EPSG:4269). We use this information to create a new <code>gpd.GeoDataFrame</code> from the <code>pd.DataFrame</code> using the GeoPandas function <code>points_from_xy()</code> like this:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>power_plants <span class="op">=</span> gpd.GeoDataFrame(power_plants, <span class="co"># data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># specify geometry column</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                                    geometry<span class="op">=</span>gpd.points_from_xy(power_plants.longitude, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                                             power_plants.latitude),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># specify CRS</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                    crs<span class="op">=</span><span class="st">'EPSG:4326'</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check we now have a geometry column:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>power_plants.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unnamed: 0</th>
      <th>objectid</th>
      <th>plant_code</th>
      <th>plant_name</th>
      <th>utility_id</th>
      <th>utility_name</th>
      <th>sector_name</th>
      <th>street_address</th>
      <th>city</th>
      <th>county</th>
      <th>state</th>
      <th>zip</th>
      <th>primsource</th>
      <th>source_desc</th>
      <th>tech_desc</th>
      <th>install_mw</th>
      <th>total_mw</th>
      <th>bat_mw</th>
      <th>bio_mw</th>
      <th>coal_mw</th>
      <th>geo_mw</th>
      <th>hydro_mw</th>
      <th>hydrops_mw</th>
      <th>ng_mw</th>
      <th>nuclear_mw</th>
      <th>crude_mw</th>
      <th>solar_mw</th>
      <th>wind_mw</th>
      <th>other_mw</th>
      <th>source</th>
      <th>period</th>
      <th>longitude</th>
      <th>latitude</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>11570</td>
      <td>1</td>
      <td>Sand Point</td>
      <td>63560</td>
      <td>TDX Sand Point Generating, LLC</td>
      <td>Electric Utility</td>
      <td>100 Power Plant Way</td>
      <td>Sand Point</td>
      <td>Aleutians East</td>
      <td>Alaska</td>
      <td>99661.0</td>
      <td>petroleum</td>
      <td>Petroleum = 1.3 MW, Wind = 0.4 MW</td>
      <td>Petroleum Liquids; Onshore Wind Turbine;</td>
      <td>3.7</td>
      <td>1.7</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.3</td>
      <td>NaN</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>EIA-860, EIA-860M and EIA-923</td>
      <td>202305.0</td>
      <td>-160.497222</td>
      <td>55.339722</td>
      <td>POINT (-160.49722 55.33972)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>11571</td>
      <td>2</td>
      <td>Bankhead Dam</td>
      <td>195</td>
      <td>Alabama Power Co</td>
      <td>Electric Utility</td>
      <td>19001 Lock 17 Road</td>
      <td>Northport</td>
      <td>Tuscaloosa</td>
      <td>Alabama</td>
      <td>35476.0</td>
      <td>hydroelectric</td>
      <td>Hydroelectric = 53 MW</td>
      <td>Conventional Hydroelectric</td>
      <td>53.9</td>
      <td>53.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>53.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>EIA-860, EIA-860M and EIA-923</td>
      <td>202305.0</td>
      <td>-87.356823</td>
      <td>33.458665</td>
      <td>POINT (-87.35682 33.45867)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>11572</td>
      <td>3</td>
      <td>Barry</td>
      <td>195</td>
      <td>Alabama Power Co</td>
      <td>Electric Utility</td>
      <td>North Highway 43</td>
      <td>Bucks</td>
      <td>Mobile</td>
      <td>Alabama</td>
      <td>36512.0</td>
      <td>natural gas</td>
      <td>Coal = 1118.5 MW, Natural Gas = 1296.2 MW</td>
      <td>Conventional Steam Coal; Natural Gas Fired Com...</td>
      <td>2569.5</td>
      <td>2414.7</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1118.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1296.2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>EIA-860, EIA-860M and EIA-923</td>
      <td>202305.0</td>
      <td>-88.010300</td>
      <td>31.006900</td>
      <td>POINT (-88.01030 31.00690)</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s see some information about the CRS of our power plants dataset:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print information about the </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'is geographic?: '</span>, power_plants.crs.is_geographic)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'is projected?: '</span>, power_plants.crs.is_projected)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'datum: '</span>, power_plants.crs.datum)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'ellipsoid: '</span>, power_plants.crs.ellipsoid)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>power_plants.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>is geographic?:  True
is projected?:  False
datum:  World Geodetic System 1984 ensemble
ellipsoid:  WGS 84</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>Now that we have a geometry column and a CRS, we can plot our dataset:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>power_plants.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-12-csv-to-geo_files/figure-html/cell-11-output-2.png" width="580" height="408"></p>
</div>
</div>
</section>
<section id="tiger-shapefile" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="tiger-shapefile"><span class="header-section-number">14.3</span> TIGER shapefile</h2>
<p>Next, we import the TIGER shapefile:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read-in data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> gpd.read_file(<span class="st">'data/tl_2022_us_state/tl_2022_us_state.shp'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># update column names to small caps</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>states.columns <span class="op">=</span> states.columns.<span class="bu">str</span>.lower()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>states.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>region</th>
      <th>division</th>
      <th>statefp</th>
      <th>statens</th>
      <th>geoid</th>
      <th>stusps</th>
      <th>name</th>
      <th>lsad</th>
      <th>mtfcc</th>
      <th>funcstat</th>
      <th>aland</th>
      <th>awater</th>
      <th>intptlat</th>
      <th>intptlon</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>5</td>
      <td>54</td>
      <td>01779805</td>
      <td>54</td>
      <td>WV</td>
      <td>West Virginia</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>62266456923</td>
      <td>489045863</td>
      <td>+38.6472854</td>
      <td>-080.6183274</td>
      <td>POLYGON ((-77.75438 39.33346, -77.75422 39.333...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>5</td>
      <td>12</td>
      <td>00294478</td>
      <td>12</td>
      <td>FL</td>
      <td>Florida</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>138962819934</td>
      <td>45971472526</td>
      <td>+28.3989775</td>
      <td>-082.5143005</td>
      <td>MULTIPOLYGON (((-83.10874 24.62949, -83.10711 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>3</td>
      <td>17</td>
      <td>01779784</td>
      <td>17</td>
      <td>IL</td>
      <td>Illinois</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>143778515726</td>
      <td>6216539665</td>
      <td>+40.1028754</td>
      <td>-089.1526108</td>
      <td>POLYGON ((-87.89243 38.28285, -87.89334 38.282...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>4</td>
      <td>27</td>
      <td>00662849</td>
      <td>27</td>
      <td>MN</td>
      <td>Minnesota</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>206244837557</td>
      <td>18937184315</td>
      <td>+46.3159573</td>
      <td>-094.1996043</td>
      <td>POLYGON ((-95.31989 48.99892, -95.31747 48.998...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>5</td>
      <td>24</td>
      <td>01714934</td>
      <td>24</td>
      <td>MD</td>
      <td>Maryland</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>25151771744</td>
      <td>6979295311</td>
      <td>+38.9466584</td>
      <td>-076.6744939</td>
      <td>POLYGON ((-75.75600 39.24607, -75.75579 39.243...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s see some information about the CRS of our states geodataframe:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print information about the CRS</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>states.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;Geographic 2D CRS: EPSG:4269&gt;
Name: NAD83
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: North America - onshore and offshore: Canada - Alberta; British Columbia; Manitoba; New Brunswick; Newfoundland and Labrador; Northwest Territories; Nova Scotia; Nunavut; Ontario; Prince Edward Island; Quebec; Saskatchewan; Yukon. Puerto Rico. United States (USA) - Alabama; Alaska; Arizona; Arkansas; California; Colorado; Connecticut; Delaware; Florida; Georgia; Hawaii; Idaho; Illinois; Indiana; Iowa; Kansas; Kentucky; Louisiana; Maine; Maryland; Massachusetts; Michigan; Minnesota; Mississippi; Missouri; Montana; Nebraska; Nevada; New Hampshire; New Jersey; New Mexico; New York; North Carolina; North Dakota; Ohio; Oklahoma; Oregon; Pennsylvania; Rhode Island; South Carolina; South Dakota; Tennessee; Texas; Utah; Vermont; Virginia; Washington; West Virginia; Wisconsin; Wyoming. US Virgin Islands. British Virgin Islands.
- bounds: (167.65, 14.92, -47.74, 86.46)
Datum: North American Datum 1983
- Ellipsoid: GRS 1980
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>And plot it:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>states.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-12-csv-to-geo_files/figure-html/cell-14-output-2.png" width="566" height="183"></p>
</div>
</div>
<p>Notice the map covers a big extension, this is because, according to the TIGER shapefiles metadata:</p>
<blockquote class="blockquote">
<p>In addition to the fifty states, the Census Bureau treats the District of Columbia, Puerto Rico, and the Island areas (American Samoa, the Commonwealth of the Northern Mariana Islands, Guam, and the U.S. Virgin Islands) as statistical equivalents of states for the purpose of data presentation.</p>
</blockquote>
<p>In <a href="https://www2.census.gov/geo/pdfs/maps-data/maps/reference/us_regdiv.pdf">this US Census Bureau file</a> we can see what each code for the region, division, and state corresponds to. These should be numeric codes, so we can start by updating the corresponding columns in the states geo-dataframe:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># notice region, division, and statefp are strings (object) types</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a> states.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>region        object
division      object
statefp       object
statens       object
geoid         object
stusps        object
name          object
lsad          object
mtfcc         object
funcstat      object
aland          int64
awater         int64
intptlat      object
intptlon      object
geometry    geometry
dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># update dtypes of code columns</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>states.region <span class="op">=</span> states.region.astype(<span class="st">'int'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>states.division <span class="op">=</span> states.division.astype(<span class="st">'int'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>states.statefp <span class="op">=</span> states.statefp.astype(<span class="st">'int'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>States corresponds to regions 1 through 4. However, there’s also a region code 9. These rows correspond to non-state regions:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(states.region.unique())</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>states[states.region<span class="op">==</span><span class="dv">9</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[3 2 1 4 9]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>region</th>
      <th>division</th>
      <th>statefp</th>
      <th>statens</th>
      <th>geoid</th>
      <th>stusps</th>
      <th>name</th>
      <th>lsad</th>
      <th>mtfcc</th>
      <th>funcstat</th>
      <th>aland</th>
      <th>awater</th>
      <th>intptlat</th>
      <th>intptlon</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>34</th>
      <td>9</td>
      <td>0</td>
      <td>78</td>
      <td>01802710</td>
      <td>78</td>
      <td>VI</td>
      <td>United States Virgin Islands</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>348021909</td>
      <td>1550236187</td>
      <td>+18.3392359</td>
      <td>-064.9500433</td>
      <td>MULTIPOLYGON (((-64.76834 18.26033, -64.77074 ...</td>
    </tr>
    <tr>
      <th>35</th>
      <td>9</td>
      <td>0</td>
      <td>69</td>
      <td>01779809</td>
      <td>69</td>
      <td>MP</td>
      <td>Commonwealth of the Northern Mariana Islands</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>472292521</td>
      <td>4644252458</td>
      <td>+15.0010865</td>
      <td>+145.6181702</td>
      <td>MULTIPOLYGON (((145.05897 14.12500, 145.06302 ...</td>
    </tr>
    <tr>
      <th>36</th>
      <td>9</td>
      <td>0</td>
      <td>66</td>
      <td>01802705</td>
      <td>66</td>
      <td>GU</td>
      <td>Guam</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>543555849</td>
      <td>934337453</td>
      <td>+13.4417451</td>
      <td>+144.7719021</td>
      <td>POLYGON ((144.56343 13.44806, 144.56357 13.450...</td>
    </tr>
    <tr>
      <th>41</th>
      <td>9</td>
      <td>0</td>
      <td>60</td>
      <td>01802701</td>
      <td>60</td>
      <td>AS</td>
      <td>American Samoa</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>197759069</td>
      <td>1307243751</td>
      <td>-14.2671590</td>
      <td>-170.6682674</td>
      <td>MULTIPOLYGON (((-170.53809 -14.33613, -170.548...</td>
    </tr>
    <tr>
      <th>49</th>
      <td>9</td>
      <td>0</td>
      <td>72</td>
      <td>01779808</td>
      <td>72</td>
      <td>PR</td>
      <td>Puerto Rico</td>
      <td>00</td>
      <td>G4000</td>
      <td>A</td>
      <td>8869029522</td>
      <td>4922249087</td>
      <td>+18.2176480</td>
      <td>-066.4107992</td>
      <td>MULTIPOLYGON (((-66.32322 17.87767, -66.33170 ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can check that Alaska and the non-state regions are causing the long map:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data in states that is not Alaska (code 2) and doesn't have region code 9</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>states[(states.statefp<span class="op">!=</span><span class="dv">2</span>) <span class="op">&amp;</span> (states.region<span class="op">!=</span><span class="dv">9</span>)].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-12-csv-to-geo_files/figure-html/cell-18-output-2.png" width="566" height="214"></p>
</div>
</div>
</section>
<section id="data-selection" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="data-selection"><span class="header-section-number">14.4</span> Data selection</h2>
<p>For the pupose of this exercise, we want to keep only data for the contiguous states. Let’s overwrite the geo-dataframes accordingly:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> states[(states.region<span class="op">!=</span><span class="dv">9</span>) <span class="op">&amp;</span> (<span class="op">~</span>states.statefp.isin([<span class="dv">2</span>,<span class="dv">15</span>]))]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>power_plants <span class="op">=</span> power_plants[<span class="op">~</span>power_plants.state.isin([<span class="st">'Puerto Rico'</span>,<span class="st">'Hawaii'</span>,<span class="st">'Alaska'</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="plotting"><span class="header-section-number">14.5</span> Plotting</h2>
<p>We can now try plotting both datasets together. To color the power_plants dots according to color we just need</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add states </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>states.plot(ax<span class="op">=</span>ax,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            edgecolor <span class="op">=</span> <span class="st">'slategray'</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># add electric power plants colored by energy source</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>power_plants.plot(ax<span class="op">=</span>ax, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                  column<span class="op">=</span><span class="st">'primsource'</span>, <span class="co"># color points according to primsource value</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                  legend<span class="op">=</span><span class="va">True</span>,    <span class="co"># add legend</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                  markersize <span class="op">=</span> <span class="dv">4</span>, <span class="co"># adjust point size</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                  cmap<span class="op">=</span><span class="st">'tab20'</span>, <span class="co"># this color map has 20 different colors</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                  alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="lesson-12-csv-to-geo_files/figure-html/cell-20-output-1.png" width="566" height="322"></p>
</div>
</div>
<p>And we can finish by adding more information to contextualize our map:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># figsize updates the figure size</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the axis box around the map</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># update title</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Operable electric generating plants in the contiguous United States'</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># annotate the data source</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">"Data: U.S. Energy Information Administration (EIA), accessed Oct 30, 2023 </span><span class="ch">\n</span><span class="st">https://atlas.eia.gov/datasets/eia::power-plants/about"</span>, </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>            xy<span class="op">=</span>(<span class="fl">0.25</span>, <span class="fl">.06</span>), <span class="co"># position</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>            xycoords<span class="op">=</span><span class="st">'figure fraction'</span>, </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>            fontsize<span class="op">=</span><span class="dv">10</span>, </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'#555555'</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># add states </span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>states.plot(ax<span class="op">=</span>ax,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>               color<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>               edgecolor <span class="op">=</span> <span class="st">'#362312'</span>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co"># add electric power plants colored by energy source</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>power_plants.plot(ax<span class="op">=</span>ax, </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>                  column<span class="op">=</span><span class="st">'primsource'</span>,</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>                  legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>                  markersize <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>                  cmap<span class="op">=</span><span class="st">'tab20'</span>,</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>                  alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># adjust legend</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>                  legend_kwds<span class="op">=</span>{<span class="st">'loc'</span>: <span class="st">"lower right"</span>, </span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'title'</span>:<span class="st">'Primary energy source'</span>,</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'title_fontsize'</span>:<span class="st">'small'</span>, </span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'fontsize'</span>:<span class="st">'small'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>&lt;AxesSubplot:title={'center':'Operable electric generating plants in the contiguous United States'}&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="lesson-12-csv-to-geo_files/figure-html/cell-21-output-2.png" width="923" height="501"></p>
</div>
</div>
<!--

https://www.flexprojector.com

https://www.earthdatascience.org/courses/scientists-guide-to-plotting-data-in-python/plot-spatial-data/customize-vector-plots/python-customize-map-legends-geopandas/

https://stackoverflow.com/questions/74143732/customize-legend-labels-in-geopandas
-->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../lectures/lesson-11-crs.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Coordinate Reference Systems</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>